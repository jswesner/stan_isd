---
output: github_document
title: "Bayesian hierarchical modeling of size spectra"
bibliography: refs.bib
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This repository contains code to recreate the analyses in Wesner et al. *Bayesian hierarchical modeling of size spectra*. The purpose of the paper is to demonstrate how build Bayesian generalized models using the truncated Pareto distribution. For a detailed derivation of the distribution, see @edwards2017 and @edwards2020. All analyses in the paper depend on the `isdbayes` package, which can be found here: <https://github.com/jswesner/isdbayes>.

## Recreate analyses

All figures and tables in the main text can be recreated by running the R scripts in the `\code` folder.

The scripts have the following naming convention and function:

**1) figure_X_fit_models.R**: Simulates data and fits models associated with Figure X in the manuscript.

**2) figure_X_get_posteriors.R**: Wrangles posterior summaries from the fitted models.

**3) figure_X_make_plots.R**: Creates the figures from the wrangled posteriors.

When there is minimal wrangling, some of the steps are merged. For example, `code/get_posteriors_make_plots.R` wrangles the posteriors and creates the figure below. It shows three modeling approaches (a-d) for dealing with an outlier in the size spectrum parameter $\lambda$.

```{r echo=FALSE, fig.cap = "", out.width = '100%'}

knitr::include_graphics(here::here("plots/fig4hierarchical_regression_plot.jpg"))
```

All scripts are self-contained. In other words, you can make the plots without needing to run the models or extract the posteriors, and vice versa. Posterior summaries are stored in the folder `\posteriors`.

## Needing a cluster

Most of the model scripts will not work on a personal computer. They require a cluster, because the models are repeatedly fit 1000 times, resulting in large files. However, fitted models are located in the `\models` folder. Some of the model fits were too big to upload to GitHub (e.g., Figures 1-3). Those model fits in the main manusript are instead stored on Zenodo [here](https://zenodo.org/records/10689765). Supplementary models are stored [here](https://zenodo.org/records/10698127). In the posterior scripts, those models are loaded from the Zenodo urls.

## References

::: {#refs}
:::
